<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>2048 Game</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #faf8ef;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 100vh;
      margin: 0;
      padding: 40px 20px;
      color: #776e65;
    }

    h1 {
      font-weight: 700;
      font-size: 48px;
      margin-bottom: 10px;
      color: #776e65;
    }

    .game-container {
      background: #bbada0;
      border-radius: 10px;
      padding: 15px;
      box-shadow: 0 0 15px rgba(0,0,0,0.2);
      position: relative;
      width: 400px;
      height: 400px;
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      grid-gap: 15px;
      margin-bottom: 20px;
    }

    .tile {
      background: #cdc1b4;
      border-radius: 6px;
      font-size: 55px;
      font-weight: 700;
      display: flex;
      justify-content: center;
      align-items: center;
      color: #776e65;
      user-select: none;
      transition: background 0.3s ease, color 0.3s ease;
    }

    .tile[data-value="2"] { background: #eee4da; color: #776e65; }
    .tile[data-value="4"] { background: #ede0c8; color: #776e65; }
    .tile[data-value="8"] { background: #f2b179; color: #f9f6f2; }
    .tile[data-value="16"] { background: #f59563; color: #f9f6f2; }
    .tile[data-value="32"] { background: #f67c5f; color: #f9f6f2; }
    .tile[data-value="64"] { background: #f65e3b; color: #f9f6f2; }
    .tile[data-value="128"] { background: #edcf72; color: #f9f6f2; font-size: 45px; }
    .tile[data-value="256"] { background: #edcc61; color: #f9f6f2; font-size: 45px; }
    .tile[data-value="512"] { background: #edc850; color: #f9f6f2; font-size: 45px; }
    .tile[data-value="1024"] { background: #edc53f; color: #f9f6f2; font-size: 35px; }
    .tile[data-value="2048"] { background: #edc22e; color: #f9f6f2; font-size: 35px; }

    .score-container {
      margin-bottom: 20px;
      font-size: 24px;
      font-weight: 600;
    }

    button {
      background: #8f7a66;
      border: none;
      border-radius: 5px;
      color: #f9f6f2;
      padding: 12px 20px;
      font-size: 18px;
      cursor: pointer;
      transition: background 0.3s ease;
    }

    button:hover {
      background: #776e65;
    }

    .message {
      font-size: 20px;
      font-weight: 700;
      margin-top: 10px;
      color: #776e65;
    }

    @media (max-width: 450px) {
      .game-container {
        width: 320px;
        height: 320px;
        grid-gap: 10px;
      }
      .tile {
        font-size: 40px;
      }
      .tile[data-value="128"],
      .tile[data-value="256"],
      .tile[data-value="512"] {
        font-size: 30px;
      }
      .tile[data-value="1024"],
      .tile[data-value="2048"] {
        font-size: 25px;
      }
    }
  </style>
</head>
<body>

  <h1>2048 Game</h1>
  <div class="score-container" aria-live="polite" aria-atomic="true">
    Score: <span id="score">0</span>
  </div>
  <div class="game-container" role="grid" aria-label="2048 Game Board" tabindex="0"></div>
  <button id="restart">Restart Game</button>
  <div class="message" role="alert" aria-live="assertive"></div>

  <script>
    const size = 4;
    let board = [];
    let score = 0;

    const gameContainer = document.querySelector('.game-container');
    const scoreDisplay = document.getElementById('score');
    const messageDisplay = document.querySelector('.message');
    const restartBtn = document.getElementById('restart');

    // Initialize empty board
    function initBoard() {
      board = [];
      for (let i = 0; i < size; i++) {
        board[i] = [];
        for (let j = 0; j < size; j++) {
          board[i][j] = 0;
        }
      }
      score = 0;
      updateScore();
      messageDisplay.textContent = '';
      addRandomTile();
      addRandomTile();
      renderBoard();
    }

    // Render the board
    function renderBoard() {
      gameContainer.innerHTML = '';
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          const tileValue = board[i][j];
          const tile = document.createElement('div');
          tile.classList.add('tile');
          if (tileValue !== 0) {
            tile.setAttribute('data-value', tileValue);
            tile.textContent = tileValue;
          }
          else {
            tile.removeAttribute('data-value');
            tile.textContent = '';
          }
          tile.setAttribute('role', 'gridcell');
          tile.setAttribute('aria-label', tileValue === 0 ? 'Empty cell' : `Tile with value ${tileValue}`);
          gameContainer.appendChild(tile);
        }
      }
    }

    // Add a random tile (2 or 4) in an empty spot
    function addRandomTile() {
      let emptyPositions = [];
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (board[i][j] === 0) {
            emptyPositions.push({x: i, y: j});
          }
        }
      }
      if (emptyPositions.length === 0) return;

      const pos = emptyPositions[Math.floor(Math.random() * emptyPositions.length)];
      board[pos.x][pos.y] = Math.random() < 0.9 ? 2 : 4;
    }

    // Update score display
    function updateScore() {
      scoreDisplay.textContent = score;
    }

    // Move and merge logic helpers
    function slide(row) {
      // remove zeros
      let arr = row.filter(val => val);
      for (let i = 0; i < arr.length - 1; i++) {
        if (arr[i] === arr[i + 1]) {
          arr[i] *= 2;
          score += arr[i];
          arr[i + 1] = 0;
        }
      }
      arr = arr.filter(val => val);
      while (arr.length < size) {
        arr.push(0);
      }
      return arr;
    }

    // Move left
    function moveLeft() {
      let moved = false;
      for (let i = 0; i < size; i++) {
        const oldRow = board[i].slice();
        const newRow = slide(oldRow);
        board[i] = newRow;
        if (!arraysEqual(oldRow, newRow)) moved = true;
      }
      return moved;
    }

    // Move right
    function moveRight() {
      let moved = false;
      for (let i = 0; i < size; i++) {
        let oldRow = board[i].slice();
        oldRow.reverse();
        let newRow = slide(oldRow);
        newRow.reverse();
        board[i] = newRow;
        if (!arraysEqual(board[i], oldRow.reverse())) moved = true;
      }
      return moved;
    }

    // Move up
    function moveUp() {
      let moved = false;
      for (let col = 0; col < size; col++) {
        let column = [];
        for (let row = 0; row < size; row++) {
          column.push(board[row][col]);
        }
        const oldCol = column.slice();
        const newCol = slide(column);
        for (let row = 0; row < size; row++) {
          board[row][col] = newCol[row];
        }
        if (!arraysEqual(oldCol, newCol)) moved = true;
      }
      return moved;
    }

    // Move down
    function moveDown() {
      let moved = false;
      for (let col = 0; col < size; col++) {
        let column = [];
        for (let row = 0; row < size; row++) {
          column.push(board[row][col]);
        }
        column.reverse();
        const oldCol = column.slice();
        const newCol = slide(column);
        newCol.reverse();
        for (let row = 0; row < size; row++) {
          board[row][col] = newCol[row];
        }
        if (!arraysEqual(oldCol.reverse(), newCol)) moved = true;
      }
      return moved;
    }

    // Helper to check if arrays equal
    function arraysEqual(a, b) {
      if (a.length !== b.length) return false;
      for (let i = 0; i < a.length; i++) {
        if (a[i] !== b[i]) return false;
      }
      return true;
    }

    // Check for game over (no moves left)
    function isGameOver() {
      // If any zero exists, not game over
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (board[i][j] === 0) return false;
        }
      }
      // Check for possible merges horizontally or vertically
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size -1; j++) {
          if (board[i][j] === board[i][j+1]) return false;
        }
      }
      for (let j = 0; j < size; j++) {
        for (let i = 0; i < size -1; i++) {
          if (board[i][j] === board[i+1][j]) return false;
        }
      }
      return true;
    }

    // Check for win (tile 2048)
    function checkWin() {
      for (let i = 0; i < size; i++) {
        for (let j = 0; j < size; j++) {
          if (board[i][j] === 2048) return true;
        }
      }
      return false;
    }

    // Handle key presses for game moves
    function handleKey(event) {
      let moved = false;
      switch (event.key) {
        case 'ArrowLeft':
          moved = moveLeft();
          break;
        case 'ArrowRight':
          moved = moveRight();
          break;
        case 'ArrowUp':
          moved = moveUp();
          break;
        case 'ArrowDown':
          moved = moveDown();
          break;
        default:
          return; // Ignore other keys
      }

      if (moved) {
        addRandomTile();
        updateScore();
        renderBoard();

        if (checkWin()) {
          messageDisplay.textContent = 'ðŸŽ‰ You reached 2048! You win!';
          document.removeEventListener('keydown', handleKey);
        } else if (isGameOver()) {
          messageDisplay.textContent = 'Game Over! No more moves.';
          document.removeEventListener('keydown', handleKey);
        }
      }
    }

    restartBtn.addEventListener('click', () => {
      initBoard();
      document.addEventListener('keydown', handleKey);
    });

    // Initialize game on load
    initBoard();
    document.addEventListener('keydown', handleKey);
  </script>

</body>
</html>
